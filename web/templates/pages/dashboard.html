
{{ define "content" }}
<div class="user-center">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <div class="user-profile-card">
        <div class="user-avatar">
            {{ if .User }}
                {{ $initial := firstChar .User.Username }}
                {{ $initial }}
            {{ else }}
                U
            {{ end }}
        </div>
        <div class="user-info">
            <h2 class="user-name">{{ .User.Username }}</h2>
            <p class="user-email">{{ .User.Email }}</p>
            <p class="user-since">æ³¨å†Œäº {{ .User.CreatedAt.Format "2006-01-02" }}</p>
        </div>
        <div class="user-actions">
            <a href="/dashboard/settings" class="action-link settings-link" title="è´¦å·è®¾ç½®">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </a>
            <a href="/auth/logout" class="action-link logout-link" title="é€€å‡ºç™»å½•" onclick="return confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
            </a>
        </div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="user-stats">
        <div class="stat-item" data-tab="history">
            <span class="stat-icon">ğŸ“º</span>
            <span class="stat-value">{{ .HistoryCount }}</span>
            <span class="stat-label">éƒ¨åœ¨çœ‹</span>
        </div>
        <div class="stat-item" data-tab="wish">
            <span class="stat-icon">â¤ï¸</span>
            <span class="stat-value">{{ .FavoriteCount }}</span>
            <span class="stat-label">éƒ¨æƒ³çœ‹</span>
        </div>
        <div class="stat-item" data-tab="watched">
            <span class="stat-icon">âœ…</span>
            <span class="stat-value">{{ .WatchedCount }}</span>
            <span class="stat-label">éƒ¨å·²çœ‹</span>
        </div>
    </div>

    <!-- Tab åˆ‡æ¢ -->
    <div class="tab-nav">
        <button class="tab-btn active"
                hx-get="/api/htmx/dashboard/history"
                hx-target="#tab-content"
                hx-trigger="click, load"
                preload="mouseover" 
                preload-delay="300ms"
                data-tab="history">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            åœ¨çœ‹
        </button>
        <button class="tab-btn"
                hx-get="/api/htmx/dashboard/wish"
                hx-target="#tab-content"
                hx-trigger="click"
                preload="mouseover" 
                preload-delay="300ms"
                data-tab="wish">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            æƒ³çœ‹
        </button>
        <button class="tab-btn"
                hx-get="/api/htmx/dashboard/watched"
                hx-target="#tab-content"
                hx-trigger="click"
                preload="mouseover" 
                preload-delay="300ms"
                data-tab="watched">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            å·²çœ‹
        </button>
    </div>

    <!-- Tab å†…å®¹åŒºåŸŸ -->
    <div class="tab-content" id="tab-content">
        <!-- ç”± HTMX åŠ¨æ€åŠ è½½ -->
        <div class="loading-state" style="text-align: center; padding: 2rem;">
            <span class="loading-spinner"></span> æ­£åœ¨åŠ è½½...
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab æ ·å¼åˆ‡æ¢ï¼ˆä¸å¤„ç†å†…å®¹åŠ è½½ï¼ŒåŠ è½½ç”± HTMX è´Ÿè´£ï¼‰
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // å¤„ç†ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»è·³è½¬å¹¶è§¦å‘åŠ è½½
    const statItems = document.querySelectorAll('.stat-item');
    statItems.forEach(item => {
        item.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            const targetBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (targetBtn) {
                targetBtn.click();
            }
        });
    });
});
</script>
{{ end }}
