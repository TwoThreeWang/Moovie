
{{ define "content" }}
<div class="user-center">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <div class="user-profile-card">
        <div class="user-avatar">
            {{ if .User }}
                {{ $initial := slice .User.Username 0 1 }}
                {{ $initial }}
            {{ else }}
                U
            {{ end }}
        </div>
        <div class="user-info">
            <h2 class="user-name">{{ .User.Username }}</h2>
            <p class="user-email">{{ .User.Email }}</p>
            <p class="user-since">æ³¨å†Œäº {{ .User.CreatedAt.Format "2006-01-02" }}</p>
        </div>
        <a href="/dashboard/settings" class="settings-link" title="è´¦å·è®¾ç½®">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </a>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="user-stats">
        <div class="stat-item" data-tab="favorites">
            <span class="stat-icon">â¤ï¸</span>
            <span class="stat-value">{{ .FavoriteCount }}</span>
            <span class="stat-label">éƒ¨æ”¶è—</span>
        </div>
        <div class="stat-item" data-tab="history">
            <span class="stat-icon">ğŸ“º</span>
            <span class="stat-value">{{ .HistoryCount }}</span>
            <span class="stat-label">æ¡è®°å½•</span>
        </div>
    </div>

    <!-- Tab åˆ‡æ¢ -->
    <div class="tab-nav">
        <button class="tab-btn active" data-tab="favorites">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            æˆ‘çš„æ”¶è—
        </button>
        <button class="tab-btn" data-tab="history">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            è§‚å½±å†å²
        </button>
    </div>

    <!-- Tab å†…å®¹åŒºåŸŸ -->
    <div class="tab-content">
        <!-- æ”¶è— Tab -->
        <div class="tab-pane active" id="tab-favorites">
            {{ if .Favorites }}
            <div class="movie-grid">
                {{ range .Favorites }}
                <a href="/movie/{{ .Movie.DoubanID }}" class="movie-card">
                    <div class="movie-poster">
                        <img src="{{ .Movie.Poster }}" alt="{{ .Movie.Title }}" loading="lazy">
                        {{ if .Movie.Rating }}
                        <span class="movie-rating">{{ .Movie.Rating }}</span>
                        {{ end }}
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">{{ .Movie.Title }}</h3>
                        <p class="movie-year">{{ .Movie.Year }}</p>
                    </div>
                </a>
                {{ end }}
            </div>
            {{ if gt .FavoriteCount 20 }}
            <div class="tab-more">
                <a href="/dashboard/favorites" class="btn btn-secondary">æŸ¥çœ‹å…¨éƒ¨æ”¶è—</a>
            </div>
            {{ end }}
            {{ else }}
            <div class="empty-state">
                <p>è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•å½±ç‰‡</p>
                <a href="/" class="btn btn-primary">å»å‘ç°å¥½ç‰‡</a>
            </div>
            {{ end }}
        </div>

        <!-- å†å² Tab -->
        <div class="tab-pane" id="tab-history">
            {{ if .History }}
            <div class="movie-grid">
                {{ range .History }}
                <div class="movie-card-wrapper history-card-wrapper" id="history-{{ .ID }}">
                    <a href="/search?kw={{ .Title }}" class="movie-card" title="ç‚¹å‡»æœç´¢èµ„æºç»­æ’­">
                        <div class="movie-poster">
                            <img src="{{ if .Poster }}/api/proxy/image?url={{ .Poster }}{{ else }}/static/img/placeholder.jpg{{ end }}" alt="{{ .Title }}" loading="lazy">
                        </div>
                        <div class="movie-info">
                            <h3 class="movie-title">{{ .Title }}</h3>
                            <p class="movie-year">{{ .Episode }}</p>
                        </div>
                    </a>
                    <button class="watch-delete-btn"
                            hx-delete="/api/history/{{ .ID }}"
                            hx-target="#history-{{ .ID }}"
                            hx-swap="outerHTML"
                            title="åˆ é™¤æ­¤è®°å½•">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                {{ end }}
            </div>
            {{ if gt .HistoryCount 20 }}
            <div class="tab-more">
                <a href="/dashboard/history" class="btn btn-secondary">æŸ¥çœ‹å…¨éƒ¨å†å²</a>
            </div>
            {{ end }}
            {{ else }}
            <div class="empty-state">
                <p>è¿˜æ²¡æœ‰è§‚å½±è®°å½•</p>
                <a href="/" class="btn btn-primary">å»çœ‹ç‰‡</a>
            </div>
            {{ end }}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab åˆ‡æ¢é€»è¾‘
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;

            // ç§»é™¤æ‰€æœ‰ active ç±»
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanes.forEach(p => p.classList.remove('active'));

            // æ·»åŠ  active ç±»
            this.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        });
    });

    // ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»è·³è½¬åˆ°å¯¹åº” Tab
    const statItems = document.querySelectorAll('.stat-item');
    statItems.forEach(item => {
        item.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            const targetBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (targetBtn) {
                targetBtn.click();
            }
        });
    });
});
</script>
{{ end }}
