
{{ define "content" }}
<h1 class="page-title">观影历史</h1>

{{ if .History }}
<div class="movie-grid">
    {{ range .History }}
<div class="movie-card-wrapper history-card-wrapper" id="history-{{ .ID }}">
    {{ $playUrl := "" }}
    {{ if and .Source .VodID }}
        {{ if .DoubanID }}
            {{ $playUrl = printf "/play/%s/%s?ep=%s&douban_id=%s" .Source .VodID .Episode .DoubanID }}
        {{ else }}
            {{ $playUrl = printf "/play/%s/%s?ep=%s" .Source .VodID .Episode }}
        {{ end }}
    {{ else }}
        {{ $playUrl = printf "/search?kw=%s" .Title }}
    {{ end }}
    <a href="{{ $playUrl }}" class="movie-card" title="点击续播 {{ .Title }}">
        <div class="movie-poster">
            <img src="{{ if .Poster }}/api/proxy/image?url={{ .Poster }}{{ else }}/static/img/placeholder.jpg{{ end }}" alt="{{ .Title }}" loading="lazy" referrerpolicy="no-referrer">
        </div>
        <div class="movie-info">
            <h3 class="movie-title">{{ .Title }}</h3>
            <p class="movie-year">{{ if .Source }}[{{ .Source }}] {{ end }}{{ .Episode }}</p>
        </div>
    </a>
    <button class="watch-delete-btn"
            hx-delete="/api/history/{{ .ID }}"
            hx-target="#history-{{ .ID }}"
            hx-swap="outerHTML"
            title="删除此记录">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>
</div>
    {{ end }}
</div>
{{ else }}
<div class="empty-state">
    <p>还没有观影记录</p>
    <a href="/" class="btn btn-primary">去看片</a>
</div>
{{ end }}
{{ end }}
