{{/* ç›¸ä¼¼ç”µå½±æ¨èé¡µé¢ */}}
{{ template "base" . }}

{{ define "title" }}
ç±»ä¼¼ã€Š{{ .SourceMovie.Title }}ã€‹çš„ç”µå½±æ¨è
{{ end }}

{{ define "content" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "ç±»ä¼¼ã€Š{{ .SourceMovie.Title }}ã€‹çš„ç”µå½±æ¨è",
  "description": "åŸºäºå‰§æƒ…ã€å¯¼æ¼”ã€é¢˜æä¸å‘é‡ç›¸ä¼¼åº¦çš„ç›¸ä¼¼ç”µå½±æ¨èåˆ—è¡¨",
  "itemListOrder": "https://schema.org/ItemListOrderDescending",
  "numberOfItems": {{ len .SimilarMovies }},
  "itemListElement": [
    {{ range $i, $item := .SimilarMovies }}
    {
      "@type": "ListItem",
      "position": {{ add $i 1 }},
      "item": {
        "@type": "Movie",
        "image": "{{ $item.Movie.Poster }}",
        "name": "{{ $item.Movie.Title | js }}",
        "url": "{{ $.SiteUrl }}/movie/{{ $item.Movie.DoubanID }}"{{ $directors := jsonUnmarshal $item.Movie.Directors }}{{ if $directors }},
        "director": [
          {{ range $idx, $d := $directors }}
          {{ if $idx }},{{ end }}
          {
            "@type": "Person",
            "name": "{{ $d.name | js }}"
          }
          {{ end }}
        ]{{ end }}
      }
    }{{ if lt $i (sub (len $.SimilarMovies) 1) }},{{ end }}
    {{ end }}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "é¦–é¡µ", "item": "{{ $.SiteUrl }}/" },
    { "@type": "ListItem", "position": 2, "name": "ã€Š{{ .SourceMovie.Title }}ã€‹", "item": "{{ $.SiteUrl }}/movie/{{ .SourceMovie.DoubanID }}" },
    { "@type": "ListItem", "position": 3, "name": "ç›¸ä¼¼æ¨è", "item": "{{ $.SiteUrl }}/similar/{{ .SourceMovie.DoubanID }}" }
  ]
}
</script>
<div class="recommendations-container">
    <nav class="breadcrumbs">
        <a href="/">é¦–é¡µ</a>
        <span class="breadcrumbs-sep">â€º</span>
        <a href="/movie/{{ .SourceMovie.DoubanID }}">ã€Š{{ .SourceMovie.Title }}ã€‹</a>
        <span class="breadcrumbs-sep">â€º</span>
        <span>ç›¸ä¼¼æ¨è</span>
    </nav>
    <div class="page-header">
        <h1 class="page-title">ç±»ä¼¼ã€Š{{ .SourceMovie.Title }}ã€‹çš„ç”µå½±æ¨è</h1>
        <p class="page-subtitle">åŸºäºç›¸ä¼¼åº¦ç®—æ³•ä¸ºæ‚¨æ¨èç›¸å…³ç”µå½±</p>
    </div>

    <!-- æºç”µå½±å¡ç‰‡ -->
    <article class="source-movie-card">
        <a href="/movie/{{ .SourceMovie.DoubanID }}" class="source-movie-poster">
            <img src="https://image.baidu.com/search/down?url={{ .SourceMovie.Poster }}" alt="{{ .SourceMovie.Title }}" onerror="this.onerror=null;this.src='/static/img/placeholder.svg'">
            {{ if .SourceMovie.Rating }}
            <span class="source-movie-rating-badge">â­ {{ .SourceMovie.Rating }}</span>
            {{ end }}
        </a>
        <div class="source-movie-content">
            <h2 class="source-movie-title">
                <a href="/movie/{{ .SourceMovie.DoubanID }}">{{ .SourceMovie.Title }}</a>
            </h2>
            <div class="source-movie-meta">
                {{ if .SourceMovie.Year }}<span class="meta-year">{{ .SourceMovie.Year }}</span>{{ end }}
                {{ if .SourceMovie.Genres }}<span class="meta-genres">{{ .SourceMovie.Genres }}</span>{{ end }}
                {{ if .SourceMovie.Countries }}<span class="meta-country">{{ .SourceMovie.Countries }}</span>{{ end }}
            </div>
            {{ if .SourceMovie.Summary }}
            <p class="source-movie-summary">{{ .SourceMovie.Summary }}</p>
            {{ end }}
            <a href="/movie/{{ .SourceMovie.DoubanID }}" class="source-movie-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
        </div>
    </article>

    <!-- æ¨èç†ç”±è¯´æ˜ -->
    <div class="recommendation-explanation">
        <p>æˆ‘ä»¬é€šè¿‡åˆ†æç”µå½±çš„ç±»å‹ã€å¯¼æ¼”ã€æ¼”å‘˜ã€è¯„åˆ†å’Œå¹´ä»£ç­‰å¤šä¸ªç»´åº¦ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹ç›¸ä¼¼ç”µå½±ã€‚æ¯éƒ¨ç”µå½±éƒ½é™„æœ‰å…·ä½“çš„æ¨èç†ç”±ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£ä¸ºä»€ä¹ˆè¿™éƒ¨ç”µå½±å¯èƒ½ç¬¦åˆæ‚¨çš„å£å‘³ã€‚</p>
    </div>

    <!-- ç›¸ä¼¼ç”µå½±åˆ—è¡¨ - çºµå‘åˆ—è¡¨å¸ƒå±€ -->
    <div class="recommendations-section">
        <h2 class="section-title">ç›¸ä¼¼ç”µå½±æ¨è</h2>
        {{ if .SimilarMovies }}
        <div class="recommendations-list" id="recommendations-list">
            {{ range .SimilarMovies }}
            <article class="recommendation-card">
                <a href="/movie/{{ .Movie.DoubanID }}" class="recommendation-poster">
                    <img src="https://image.baidu.com/search/down?url={{ .Movie.Poster }}" alt="{{ .Movie.Title }}" loading="lazy" onerror="this.onerror=null;this.src='/static/img/placeholder.svg'">
                    {{ if .Movie.Rating }}
                    <span class="recommendation-rating-badge">â­ {{ .Movie.Rating }}</span>
                    {{ end }}
                </a>
                <div class="recommendation-content">
                    <h3 class="recommendation-title">
                        <a href="/movie/{{ .Movie.DoubanID }}">{{ .Movie.Title }}</a>
                    </h3>
                    <div class="recommendation-meta">
                        {{ if .Movie.Year }}<span class="meta-year">{{ .Movie.Year }}</span>{{ end }}
                        {{ if .Movie.Genres }}<span class="meta-genres">{{ .Movie.Genres }}</span>{{ end }}
                        {{ if .Movie.Countries }}<span class="meta-country">{{ .Movie.Countries }}</span>{{ end }}
                    </div>
                    {{ if .Reason }}
                    <div class="recommendation-reason {{ .ReasonType }}">
                        <span class="reason-icon">ğŸ’¡</span>
                        <span class="reason-text">{{ .Reason }}</span>
                    </div>
                    {{ end }}
                    {{ if .Movie.Summary }}
                    <p class="recommendation-summary">{{ .Movie.Summary }}</p>
                    {{ end }}
                </div>
            </article>
            {{ end }}
        </div>


        {{ else }}
        <div class="recommendations-empty">
            <p>ğŸ˜” æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°ç›¸ä¼¼çš„ç”µå½±æ¨è</p>
            <p>æ‚¨å¯ä»¥å°è¯•æµè§ˆå…¶ä»–ç”µå½±ï¼Œæˆ–è€…å»å‘ç°é¡µé¢çœ‹çœ‹çƒ­é—¨ç”µå½±ã€‚</p>
            <a href="/discover" class="btn btn-secondary">å»å‘ç°é¡µé¢</a>
        </div>
        {{ end }}
    </div>

    <!-- è¿”å›æŒ‰é’® -->
    <div class="back-section">
        <a href="/movie/{{ .SourceMovie.DoubanID }}" class="back-link">
            <span>â† è¿”å›ã€Š{{ .SourceMovie.Title }}ã€‹</span>
        </a>
    </div>
</div>

<style>
.recommendations-container {
    width: 100%;
}

.breadcrumbs {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
}
.breadcrumbs a {
    color: var(--text-secondary);
    text-decoration: none;
}
.breadcrumbs a:hover {
    color: var(--primary);
}
.breadcrumbs-sep {
    margin: 0 0.25rem;
    color: var(--text-muted);
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
}

.page-title {
    font-weight: 700;
}

.page-subtitle {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin-bottom: 0;
}

/* ================== æºç”µå½±å¡ç‰‡ ================== */
.source-movie-card {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 2rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
}

.source-movie-card:hover {
    border-color: var(--primary);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    transform: translateY(-3px);
}

.source-movie-poster {
    position: relative;
    flex-shrink: 0;
    width: 100px;
    height: 150px;
    border-radius: 8px;
    overflow: hidden;
    background: var(--bg-secondary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.source-movie-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.source-movie-card:hover .source-movie-poster img {
    transform: scale(1.05);
}

.source-movie-rating-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    display: flex;
    align-items: center;
    gap: 3px;
    padding: 4px 8px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.7) 100%);
    backdrop-filter: blur(4px);
    border-radius: 6px;
    color: var(--rating);
    font-size: 0.75rem;
    font-weight: 700;
}

.source-movie-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.source-movie-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.3;
}

.source-movie-title a {
    color: var(--text);
    text-decoration: none;
    transition: color 0.2s;
}

.source-movie-title a:hover {
    color: var(--primary);
}

.source-movie-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    flex-wrap: wrap;
}

.source-movie-meta .meta-year {
    color: var(--primary);
    font-weight: 600;
}

.source-movie-meta .meta-genres,
.source-movie-meta .meta-country {
    color: var(--text-muted);
}

.source-movie-meta span:not(:last-child)::after {
    content: "/";
    margin-left: 8px;
    color: var(--border);
    opacity: 0.5;
}

.source-movie-summary {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.source-movie-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-top: auto;
    color: var(--primary);
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: color 0.2s;
}

.source-movie-link:hover {
    color: var(--primary-dark);
}

/* ================== æ¨èç†ç”±è¯´æ˜ ================== */
.recommendation-explanation {
    background: linear-gradient(135deg, var(--primary-alpha) 0%, rgba(0, 0, 0, 0) 100%);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.recommendation-explanation p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0;
}

/* ================== æ¨èç”µå½±åˆ—è¡¨ ================== */
.recommendations-section {
    margin-bottom: 3rem;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

/* ================== æ¨èå¡ç‰‡ ================== */
.recommendation-card {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
}

.recommendation-card:hover {
    border-color: var(--primary);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    transform: translateY(-3px);
}

.recommendation-poster {
    position: relative;
    flex-shrink: 0;
    width: 90px;
    height: 127px;
    border-radius: 8px;
    overflow: hidden;
    background: var(--bg-secondary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.recommendation-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.recommendation-card:hover .recommendation-poster img {
    transform: scale(1.05);
}

.recommendation-rating-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    display: flex;
    align-items: center;
    gap: 3px;
    padding: 3px 8px;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.7) 100%);
    backdrop-filter: blur(4px);
    border-radius: 6px;
    color: var(--rating);
    font-size: 0.7rem;
    font-weight: 700;
}

.recommendation-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.recommendation-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.3;
}

.recommendation-title a {
    color: var(--text);
    text-decoration: none;
    transition: color 0.2s;
}

.recommendation-title a:hover {
    color: var(--primary);
}

.recommendation-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    flex-wrap: wrap;
}

.recommendation-meta .meta-year {
    color: var(--primary);
    font-weight: 600;
}

.recommendation-meta .meta-genres,
.recommendation-meta .meta-country {
    color: var(--text-muted);
}

.recommendation-meta span:not(:last-child)::after {
    content: "/";
    margin-left: 8px;
    color: var(--border);
    opacity: 0.5;
}

/* æ¨èç†ç”± */
.recommendation-reason {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 10px 12px;
    background: var(--bg-secondary);
    border-left: 3px solid var(--primary);
}

.recommendation-reason .reason-icon {
    flex-shrink: 0;
    font-size: 0.9rem;
}

.recommendation-reason .reason-text {
    font-size: 0.8rem;
    line-height: 1.5;
    color: var(--text-secondary);
    font-weight: 500;
}

.recommendation-reason.genre {
    border-left-color: var(--primary);
}
.recommendation-reason.genre .reason-text {
    color: var(--primary);
}

.recommendation-reason.person {
    border-left-color: var(--success);
}
.recommendation-reason.person .reason-text {
    color: var(--success);
}

.recommendation-reason.rating {
    border-left-color: var(--warning);
}
.recommendation-reason.rating .reason-text {
    color: var(--warning);
}

.recommendation-reason.era {
    border-left-color: var(--info);
}
.recommendation-reason.era .reason-text {
    color: var(--info);
}

.recommendation-summary {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.8rem;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* ================== ç©ºçŠ¶æ€ ================== */
.recommendations-empty {
    text-align: center;
    padding: 3rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
}

.recommendations-empty p {
    color: var(--text-secondary);
    margin-bottom: 1rem;
}

/* ================== è¿”å›é“¾æ¥ ================== */
.back-section {
    text-align: center;
    margin-top: 2rem;
}

.back-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    color: var(--primary);
    text-decoration: none;
    font-size: 1rem;
    font-weight: 500;
    transition: color 0.2s;
}

.back-link:hover {
    color: var(--primary-dark);
}

/* ================== å“åº”å¼è®¾è®¡ ================== */
@media (max-width: 768px) {
    .source-movie-card {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 16px;
        padding: 16px;
    }

    .source-movie-poster {
        width: 80px;
        height: 120px;
    }

    .source-movie-meta {
        justify-content: center;
    }

    .source-movie-link {
        justify-content: center;
    }

    .recommendation-card {
        padding: 12px;
        gap: 12px;
    }

    .recommendation-poster {
        width: 70px;
        height: 99px;
    }

    .recommendation-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
    }

    .recommendation-meta span:not(:last-child)::after {
        display: none;
    }
}

@media (max-width: 480px) {
    .source-movie-card {
        padding: 12px;
    }

    .source-movie-title {
        font-size: 1.1rem;
    }

    .recommendation-poster {
        width: 60px;
        height: 85px;
    }

    .recommendation-title {
        font-size: 0.9rem;
    }

    .recommendation-reason {
        padding: 8px 10px;
    }

    .recommendation-reason .reason-text {
        font-size: 0.75rem;
    }
}
</style>
{{ end }}
