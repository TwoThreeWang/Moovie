
{{ define "content" }}
<div class="search-hero">
    <form class="search-form" action="/search" method="GET">
        <div class="search-input-wrapper">
            <input
                type="text"
                name="kw"
                class="search-input"
                value="{{ .Keyword }}"
                placeholder="搜索电影、电视剧..."
                autocomplete="off"
            >
            <button type="submit" class="search-btn">搜索</button>
        </div>
    </form>
    <p class="search-result-hint">「{{ .Keyword }}」的搜索结果</p>
</div>

<div id="search-results-container"
     hx-get="/api/htmx/search?kw={{ .Keyword }}{{ if .Bypass }}&bypass=1{{ end }}"
     hx-trigger="load"
     hx-indicator="#search-loading">
    <div id="search-loading" class="htmx-indicator search-loading-state">
        <div class="loading-spinner"></div>
        <p>正在搜索全网资源，请稍候...</p>
    </div>
</div>

<style>
.search-loading-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--text-muted);
}
/* HTMX 给 indicator 元素自身加 htmx-request 类 */
.search-loading-state.htmx-request {
    display: flex;
}
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255,255,255,.1);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s ease-in-out infinite;
    margin-bottom: 1rem;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>

<script>
// 记录搜索词到最近搜索
// 使用 DOMContentLoaded 确保 app.js（defer 加载）已执行完毕
document.addEventListener('DOMContentLoaded', function() {
    const keyword = {{ .Keyword | js }};
    if (keyword && typeof addRecentSearch === 'function') {
        addRecentSearch(keyword);
    }
});
</script>
{{ end }}
