{{ define "content" }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Movie",
  "name": "{{ .Movie.Title }}",
  "image": "{{ .Movie.Poster }}",
  "datePublished": "{{ .Movie.Year }}",
  {{ if .DirectorList }}
  "director": [
    {{ range $index, $d := .DirectorList }}
      {{ if $index }},{{ end }}
      {
        "@type": "Person",
        "name": "{{ $d.Name | js }}"
      }
    {{ end }}
  ],
  {{ end }}
  {{ if .Movie.Rating }}
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ .Movie.Rating }}",
    "bestRating": "10",
    "ratingCount": "100"
  },
  {{ end }}
  "description": "{{ .Movie.Summary | js }}"
}
</script>

<div class="movie-page">
    <!-- 主要内容区：左海报+右信息 -->
    <div class="movie-header">
        <!-- 海报 -->
        <div class="movie-poster-col">
            <img src="https://image.baidu.com/search/down?url={{ .Movie.Poster }}" alt="{{ .Movie.Title }}" class="movie-poster-img" onerror="this.onerror=null;this.src='/static/img/placeholder.svg'">
        </div>

        <!-- 信息列 -->
        <div class="movie-info-col">
            <h1 class="movie-name">{{ .Movie.Title }}{{ if .Movie.Year }} <span class="movie-year-text">({{ .Movie.Year }})</span>{{ end }}</h1>

            {{ if .Movie.OriginalTitle }}
            <div class="movie-alt-name">{{ .Movie.OriginalTitle }}</div>
            {{ end }}

            <!-- 详细信息列表 -->
            <div class="movie-attrs">
                {{ if .Movie.Directors }}
                <div class="attr-row">
                    <span class="attr-label">导演:</span>
                    <span class="attr-value">{{ range $i, $d := (jsonUnmarshal .Movie.Directors) }}{{ if $i }} / {{ end }}{{ $d.name }}{{ end }}</span>
                </div>
                {{ end }}

                {{ if .Movie.Actors }}
                <div class="attr-row">
                    <span class="attr-label">主演:</span>
                    <span class="attr-value">{{ range $i, $a := (jsonUnmarshal .Movie.Actors) }}{{ if $i }} / {{ end }}{{ $a.name }}{{ end }}</span>
                </div>
                {{ end }}

                {{ if .Movie.Genres }}
                <div class="attr-row">
                    <span class="attr-label">类型:</span>
                    <span class="attr-value">{{ .Movie.Genres }}</span>
                </div>
                {{ end }}

                {{ if .Movie.Countries }}
                <div class="attr-row">
                    <span class="attr-label">地区:</span>
                    <span class="attr-value">{{ .Movie.Countries }}</span>
                </div>
                {{ end }}

                {{ if .Movie.Duration }}
                <div class="attr-row">
                    <span class="attr-label">片长:</span>
                    <span class="attr-value">{{ .Movie.Duration }}</span>
                </div>
                {{ end }}

                {{ if .Movie.IMDbID }}
                <div class="attr-row">
                    <span class="attr-label">IMDb:</span>
                    <span class="attr-value">{{ .Movie.IMDbID }}</span>
                </div>
                {{ end }}

                {{ if .Movie.DoubanID }}
                <div class="attr-row">
                    <span class="attr-label">豆瓣:</span>
                    <span class="attr-value"><a href="https://movie.douban.com/subject/{{ .Movie.DoubanID }}" target="_blank" rel="noopener nofollow" style="color: #007722; text-decoration: none;">subject/{{ .Movie.DoubanID }}</a></span>
                </div>
                {{ end }}
            </div>
        </div>

        <!-- 评分与操作 -->
        <div class="movie-rating-col">
            {{ if .Movie.Rating }}
            <div class="rating-block">
                <div class="rating-title">豆瓣评分</div>
                <div class="rating-num">{{ .Movie.Rating }}</div>
                <div class="rating-stars">
                    ★★★★★
                </div>
            </div>
            {{ end }}

            <div class="movie-actions">
                {{ template "favorite_btn.html" (dict "MovieID" .Movie.ID "IsFavorited" .IsFavorited) }}
            </div>
        </div>
    </div>

    <!-- 剧情简介 -->
    {{ if .Movie.Summary }}
    <div class="movie-section">
        <h2 class="section-title">剧情简介</h2>
        <p class="movie-summary">{{ .Movie.Summary }}</p>
    </div>
    {{ end }}

    <!-- 豆瓣短评 -->
    {{ if .Movie.DoubanID }}
    <div class="movie-section">
        <h2 class="section-title">豆瓣短评</h2>
        <div id="movie-reviews"
             hx-get="/api/htmx/reviews?douban_id={{ .Movie.DoubanID }}"
             hx-trigger="load"
             hx-indicator="#reviews-loading">
            <div id="reviews-loading" class="htmx-indicator movie-search-loading-state">
                <div class="loading-spinner"></div>
                <p>正在加载短评...</p>
            </div>
        </div>
    </div>
    {{ end }}

    <!-- 在线资源 -->
    <div class="movie-section">
        <h2 class="section-title">在线资源</h2>
        <div id="movie-search-results"
             hx-get="/api/htmx/search?kw={{ .Movie.Title }}&year={{ .Movie.Year }}"
             hx-trigger="load"
             hx-indicator="#movie-search-loading">
            <div id="movie-search-loading" class="htmx-indicator movie-search-loading-state">
                <div class="loading-spinner"></div>
                <p>正在搜索全网资源，请稍候...</p>
            </div>
        </div>
    </div>

    <!-- 相似电影推荐 -->
    <div class="movie-section">
        <h2 class="section-title">喜欢这部剧集的人也喜欢</h2>
        <div id="similar-movies"
             hx-get="/api/htmx/similar?douban_id={{ .Movie.DoubanID }}"
             hx-trigger="load"
             hx-indicator="#similar-loading">
            <div id="similar-loading" class="htmx-indicator movie-search-loading-state">
                <div class="loading-spinner"></div>
                <p>正在加载相似电影...</p>
            </div>
        </div>
    </div>
</div>

<style>
/* 电影页面搜索加载状态 - 复用 search 页面样式 */
.movie-search-loading-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--text-muted);
}
.movie-search-loading-state.htmx-request {
    display: flex;
}
</style>
{{ end }}
